@{
    ViewData["Title"] = "GEC Members";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3>GEC Members</h3>
    <a href="@Url.Action("AddNewGecMember", "GECMember")" class="btn btn-primary">
        Add New Member
    </a>
</div>


<div id="gecMembersTableContainer">
    @await Html.PartialAsync("_GECMembersTable", (List<GCI_Admin.Models.GECMember>)Model)

</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script>

        // Refresh the table dynamically
        async function refreshGECTable() {
            const response = await fetch('@Url.Action("GetMembersTable", "GECMember")');
            const html = await response.text();
            document.getElementById('gecMembersTableContainer').innerHTML = html;
        }

        // Delete member
        async function deleteGECMember(id) {
            if (!confirm("Are you sure you want to delete this member?")) return;

            const response = await fetch('@Url.Action("Delete", "GECMember")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                },
                body: JSON.stringify({ id })
            });

            const data = await response.json();
            if (response.ok) {
                alert(data.message || "Member deleted successfully");
                refreshGECTable();
            } else {
                alert(data || "Failed to delete member");
            }
        }

        // Open create modal (example, implement your modal logic)
        function openCreateModal() {
            // Load modal content dynamically or show static form
            // After create, call refreshGECTable()
        }
    </script>
}
